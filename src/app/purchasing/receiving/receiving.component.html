<div class="main-content">
    <ngx-alerts></ngx-alerts>
    <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }" ></ngx-loading>
    <div class="container-fluid">
    
              <!-- Add-Edit Section -->
              <div class="row card col-md-12" >
                    <form [formGroup]="receivingForm" (ngSubmit)="onSubmit()">
                      <div class="content">
                        <h4>  Create Receiving   </h4> 
                              <!-- Receiving Profile-->
                              <div class="row card col-md-12" style="background-color:  #f9f9f9;">
                                <div  class="col-md-4"> 
                                  <label class="control-label" for="">POs:
                                    <span class="star">*</span>
                                 </label>
                                 <!-- formControlName="PurchaseOrderId" -->
                                    <select value="-- Select--" required  (change)="onPOsSlect($event)"
                                    class="form-control" data-title="Single Select" 
                                    data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                            <option value="-- Select--" selected>-- Select--</option>
                                            <option *ngFor="let po of POsOpen" value={{po.PurchaseOrderId}}>
                                                {{po.poRemarks}}
                                            </option>
                                    </select>
                                </div>
                                <div  class="row col-md-1">

                                </div>
                                <div  class="row col-md-2" >
                                  <label class="control-label" for="">Receive to:
                                    <span class="star">*</span>
                                 </label>
                                  <div class="custom-control custom-radio">
                                   <input (change)="onChangeReceive($event)" id="Store" type="radio" class="custom-control-input" select value="Store" name="ReceiveTo" formControlName="ReceiveTo" required>
                                   <label class="custom-control-label" for="Store">Store</label>
                                 </div>
                                 <div class="custom-control custom-radio">
                                   <input  (change)="onChangeReceive($event)" id="Consumption" type="radio" class="custom-control-input" value="Consumption" name="ReceiveTo" formControlName="ReceiveTo"  required>
                                   <label class="custom-control-label" for="Consumption">Consumption</label>
                                 </div>
                               </div>
                               <div class="col-md-2" *ngIf="getReceiveTo.value == 'Consumption'">
                                <label class="control-label" for="">Select Type:
                                  <span class="star">*</span>
                               </label>
                                <select value="Employee" (change)="onChangeReceiveTo($event)"
                                    class="form-control" data-title="Single Select" 
                                    data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                            <option value="" selected>-- Select --</option>
                                            <option value="Employee" >Employee</option>
                                            <option value="Department" >Department</option>
                                            <option value="Branch" >Branch</option>
                                            <option value="Company" >Company</option>
                                </select>
                               </div>
                               <div  class="col-md-3" *ngIf="getEmpId.value != null">
                                <label class="control-label" for="">Employee:
                                  <span class="star">*</span>
                              </label>
                                <select value="0"  formControlName="EmployeeRecID"  (change)="onEmployeeSelect($event)"
                                class="form-control" data-title="Single Select" 
                                data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                      <option value="0" selected>-- Select--</option>
                                        <option *ngFor="let emp of Employees" value={{emp.empId}} >
                                            {{emp.empFullName}}
                                        </option>
                                </select>
                              </div>
                              <div  class="col-md-3" *ngIf="getDptId.value != null">
                                <label class="control-label" for="">Department:
                                  <span class="star">*</span>
                              </label>
                                <select value="0"  formControlName="DptId"  (change)="onDepartmentSelect($event)"
                                class="form-control" data-title="Single Select" 
                                data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                      <option value="0" selected>-- Select--</option>
                                        <option *ngFor="let dpt of Departments" value={{dpt.dptId}} >
                                            {{dpt.dptName}}
                                        </option>
                                </select>
                              </div>
                              <div  class="col-md-3" *ngIf="getBrnId.value != null">
                                <label class="control-label" for="">Branchs:
                                  <span class="star">*</span>
                              </label>
                                <select value="0"  formControlName="BrnId"  (change)="onBranchSelect($event)"
                                class="form-control" data-title="Single Select" 
                                data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                      <option value="0" selected>-- Select--</option>
                                        <option *ngFor="let brn of Branchs" value={{brn.brnId}} >
                                            {{brn.brnName}}
                                        </option>
                                </select>
                              </div>
                              <div  class="col-md-3" *ngIf="getComId.value != null">
                                <label class="control-label" for="">Companys:
                                  <span class="star">*</span>
                              </label>
                                <select value="0"  formControlName="ComId"  (change)="onCompanySelect($event)"
                                class="form-control" data-title="Single Select" 
                                data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                      <option value="0" selected>-- Select--</option>
                                        <option *ngFor="let com of Companys" value={{com.comId}} >
                                            {{com.comName}}
                                        </option>
                                </select>
                              </div>
                                <div  class="col-md-4" *ngIf="getReceiveTo.value == 'Store'">
                                  <label class="control-label" for="">Stores:
                                    <span class="star">*</span>
                                </label>
                                  <select value="0"  formControlName="StoreId"  (change)="onStoreSelect($event)"
                                  class="form-control" data-title="Single Select" 
                                  data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                        <option value="0" selected>-- Select--</option>
                                          <option *ngFor="let str of Stores" value={{str.StoreId}} >
                                              {{str.strName}}
                                          </option>
                                  </select>
                                </div>
                                <br><br><br><br>
                              </div>
                              <!-- Items -->
                              <div class="row card col-md-12" style="background-color:  #f9f9f9;">
                                <div class="col-md-12">
                                  <h4>Details:</h4>
                                  <div class="col-md-4">
                                   PO Remarks: {{ getReceivingForm.poRemarks.value}}
                                  </div>
                                  <div class="col-md-4">
                                   From Supplier: {{ getReceivingForm.splName.value }} 
                                  </div>
                                  <div class="col-md-4" *ngIf="getReceiveTo.value == 'Store'">
                                    To Store: {{ getReceivingForm.strName.value }}
                                   </div>
                                   <div class="col-md-4" *ngIf="getReceiveTo.value == 'Consumption' && getEmpName.value != null ">
                                    To Employee: {{ getReceivingForm.EmpName.value }}
                                   </div>
                                   <div class="col-md-4" *ngIf="getReceiveTo.value == 'Consumption' && getDptName.value != null ">
                                    To Department: {{ getReceivingForm.DptName.value }}
                                   </div>
                                   <div class="col-md-4" *ngIf="getReceiveTo.value == 'Consumption' && getBrnName.value != null ">
                                    To Branch: {{ getReceivingForm.BrnName.value }}
                                   </div>
                                   <div class="col-md-4" *ngIf="getReceiveTo.value == 'Consumption' && getComName.value != null ">
                                    To Company: {{ getReceivingForm.ComName.value }}
                                   </div>
                                   
                                  <br><br>
                               
                                </div>
                                <!-- {{  getItemsGroup.value | json}} -->
                                <div class="col-md-12">   
                                  <legend></legend>
                                  <legend>Items Table</legend>

                     
                                  <div class="col-md-1">
                                    #
                                  </div>
                                  <div class="col-md-3">
                                   Names
                                  </div>
                                  <div class="col-md-2">
                                    Qnt
                                   </div>
                                  <div class="col-md-2">
                                    Prices
                                  </div>
                                  <br>
                                </div>
                                <div formArrayName="Items" class="col-md-12">
                                      <legend> </legend>
                                      <div *ngIf="getItemsGroup.length == 0" style="color: red;" class="col-md-12 text-center"> No Items <br> <br> </div>
                                      <div *ngFor="let itm of getItemsGroup.controls; let i = index" >
                                     
                                        <div [formGroupName]="i" class="col-md-12" >
                                          <div class="controler col-md-1">
                                             {{ i+1 }}
                                          </div>
                                          <div class="controler col-md-3">
                                            {{ itm?.value?.itmName }} 
      
                                          </div>
                                          <div class="controler col-md-2">
                                             {{ itm?.value?.ItmQntPO }} 
       
                                           </div>
                                           <div class="controler col-md-2">
                                             {{ itm?.value?.itmPrice }} 
       
                                           </div>
                                        </div>
                                        <br> <br> 
                                      </div>
                                </div>
                                <br><br>    <br><br>
                              </div>
                              <!-- Footer -->
                              <div class="row footer col-md-12">
                                <!-- [disabled]="getReceivingForm().status == 'INVALID' "  -->
                                <button type="submit" class="btn btn-primary pe-7s-diskette" > Receive </button>
                                <button type="button" (click)="onCancel()" class="btn btn-primary pull-right" > Cancel </button>
                              </div>
                      </div> 
                    </form>         
              </div> 


                            <!-- Receiving List Section -->
                            <div class="row card col-md-12" >
                              <div class="content">
                              <br>
                              <h4 class="title">Receiving List</h4>
                
                                      <!-- Toolbar -->
                                      <!-- <form novalidate [formGroup]="searchForm">  -->
                                        <div class="card col-md-12 toolbarCard" >
                                          <div class=" col-md-12">
                                            <div class=" col-md-2" >                            
                                              <select value="0" (change)="onFilterByStatus($event)" class="form-control" data-title="Single Select" data-style="btn-default btn-block" data-menu-style="dropdown-blue"  >
                                              <option value="0" selected>-- Filter By --</option>
                                                <option *ngFor="let sts of Statuss" value={{sts.stsName}} >
                                                    {{sts.stsName}}
                                                </option>
                  
                                              </select> 
                                              
                                           </div>
                                            <div class=" col-md-2">
                                              <select id="PerPage" (change)="onChangeRowsPerPage($event)" class="marginsDropdownList form-control" value="5">
                                                <option value="5">Rows</option>
                                                <option value="5">5</option>
                                                <option value="10">10</option>
                                                <option value="25">25</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                    
                                                </select> 
                                            </div>
                                            <div class=" col-md-6 marginsPaging" >
                                              <pagination-controls  (pageChange)="pageIndex = $event" > </pagination-controls>
                                            </div>
                                            <br>
                                          </div>
                                          <div class=" col-md-12">
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-primary pe-7s-search"  (click)="searchFilter(searchForm.value)"> Search </button> 
                                            </div>
                                            <div class=" col-md-2 marginsSearch ">
                                              <input #search id="search" type="text" placeholder="Search" aria-label="Search" aria-describedby="basic-addon1" class="form-control" >       
                                            </div>
                                          </div>
                                        </div>
                                      <!-- </form> -->
                
                                        <div id="print-section" class="row card col-md-12 " style="overflow-x:auto;"  >
                                            <div class="content">
                                                  <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                            <!-- Table Headers -->
                                                            <thead>
                                                                  <tr>
                                                                    <th> 
                                                                      <div class=" form-check">
                                                                        <label class=" form-check-label">
                                                                          <input id="assetItemALL--" (change)="onSelectAll()" class=" form-check-input"  type="checkbox" value="" />
                                                                          <span class=" form-check-sign">
                                                                            <span class=" check"> </span>
                                                                          </span>
                                                                        </label>
                                                                      </div>
                                                                    </th>
                                                                    <th>
                                                                      #
                                                                    </th>
                                                                    <th [class.active]="order === 'poRemarks'" (click)="setOrder('empHRCode')"
                                                                      class="mdl-data-table__cell--non-numeric">
                                                                      Remarks <span [hidden]="reverse">▼</span><span [hidden]="!reverse">▲</span>
                                                                    </th>
                                                                    <th [class.active]="order === 'poRemarks'" (click)="setOrder('empHRCode')"
                                                                    class="mdl-data-table__cell--non-numeric">
                                                                    Supplier <span [hidden]="reverse">▼</span><span [hidden]="!reverse">▲</span>
                                                                    </th>
                                                                    <th [class.active]="order === 'poDate'" (click)="setOrder('empFullName')">
                                                                      Date <span [hidden]="reverse">▼</span>
                                                                      <span [hidden]="!reverse">▲</span>
                                                                    </th>
                                                                    <th [class.active]="order === 'PurchaseRequestes'" (click)="setOrder('empFullName')">
                                                                      Items <span [hidden]="reverse">▼</span>
                                                                      <span [hidden]="!reverse">▲</span>
                                                                    </th>
                                                                    <th>
                                                                      To Store
                                                                    </th>
                                                                    <th >
                                                                      Total Cost 
                                                                    </th>
                                                                  </tr>
                                                            </thead>
                                                            <!-- Table Body -->
                                                            <tbody *ngIf="POs.length == 0" ><tr  [ngStyle]="{'color': 'red'}" style="text-align:center;"> No Enties Found</tr></tbody>
                                                            <tbody *ngIf="POs.length > 0" >
                                                                  <tr  *ngFor="let row of Receivings | orderBy: order:reverse:'case-insensitive' | paginate: { itemsPerPage: pageSize, currentPage: pageIndex }; let i = index">
                                                                    <td>
                                                                      <div class="form-check">
                                                                        <label class=" form-check-label">
                                                                          <input id="assetItem--{{i}}" class=" form-check-input" (change)="onSelect($event, row)" [(ngModel)]="row.checkbox" [value]="row.checkbox" type="checkbox" value="" />
                                                                          <span class=" form-check-sign">
                                                                            <span class=" check"> </span>
                                                                          </span>
                                                                        </label>
                                                                      </div>
                                                                    </td>
                                                                    <td>
                                                                      {{ i+1 }}
                                                                    </td>
                                                                    <td>{{ row?.poRemarks }}</td>
                                                                    <td>{{ row?.splName }}</td>
                                                                    <td>{{ row?.recDate }}</td>  
                                                                    <td >
                                                                      <span *ngIf="row.Items?.length == 0">No Items</span>
                                                                      <ul *ngFor="let itm of row.Items" >
                                                                       
                                                                        <li *ngIf="itm != '' && itm.ItmQntRec != 0 " > {{itm.itmName}} ( {{ itm.ItmQntRec}}  )   </li>
                                                                            
                                                                        <li *ngIf="itm != '' && itm.ItmQntRec == 0" > {{itm.itmName}} ( {{  itm.ItmQntRecCons}} )   </li>
                                                                      </ul>
                                                                    </td>
                                                                
                                                                    <td>
                                                                   
                                                                      <span *ngIf="row?.strName != null">
                                                                        {{ row?.strName }}
                                                                      </span>
                                                                      <span *ngIf="row?.EmpName != null">
                                                                        {{ row?.EmpName }}
                                                                      </span>
                                                                      <span *ngIf="row?.DptName != null">
                                                                        {{ row?.DptName }}
                                                                      </span>
                                                                      <span *ngIf="row?.BrnName != null">
                                                                        {{ row?.BrnName }}
                                                                      </span>
                                                                      <span *ngIf="row?.ComName != null">
                                                                        {{ row?.ComName }}
                                                                      </span>

                                                                    </td>
                                                                    <td>
                                                                          {{ row.RecTotalCost }}
                                                                    </td>
                                                                  </tr>
                                                                  <tr>
                                                                    <td>
                                                                          <div  class="text-center" style="color: red; width: auto">
                                                                            <p *ngIf="POs.length === 0">
                                                                                No Entry found
                                                                            </p>
                                                                          </div>
                                                                    </td>
                                                                  </tr>
                                                            </tbody>
                                                  </table>
                                            </div> 
                                        </div> 
                              </div>
                            </div>
                            <div class="col-md-12">
                              <div class="col-md-1">
                                <select class="col-md-1" id="PerPage" (change)="onChangeRowsPerPage($event)" class="form-control col-sm-1" >
                                  <option value="5">#Rows</option>
                                  <option value="5">5</option>
                                  <option value="10">10</option>
                                  <option value="25">25</option>
                                  <option value="50">50</option>
                                  <option value="100">100</option>
                          
                                  </select> 
                              </div>
                              <div class="col-md-3">
                                <pagination-controls (pageChange)="pageIndex = $event">    </pagination-controls>
                              </div>
                            </div>
    </div>
</div>
        
  
  